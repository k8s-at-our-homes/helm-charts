hostname: timeline.example.com

config:
  timezone: Europe/Amsterdam
  minimumMinutesSpentInCity: 60
  jobConcurrency: 10
  allowEmailPasswordRegistration: false
  oidc:
    enabled: false
    providerName:
    autoRegister: false
    issuerUrl:
    clientId:
    secretName: ""
    # Optional, override the default references to the keys in the secret above
    secretKeyRef:
      issuerUrl: issuerUrl
      clientId: clientId
      clientSecret: clientSecret
route:
  enabled: false
  apiVersion: gateway.networking.k8s.io/v1
  kind: HTTPRoute
  annotations: {}
  hostnames:
  - timeline.example.com
  parentRefs: []
  filters: []
  matches: []
  timeouts: {}

ingress:
  enabled: false
  domain: timeline.example.com
  annotations:
    # proxy-body-size should be set higher when importing timeline history
    # nginx.ingress.kubernetes.io/proxy-body-size: "200m"
  tls:
    enabled: true
    secretName:

database:
  image:
    registry: ghcr.io
    repository: cloudnative-pg/postgis
    tag: 17-3.5-103

  clusterName: dawarich
  logLevel: error
  replicas: 2
  size: 5Gi
  # storageClass: ""

  nodeSelector:
    kubernetes.io/arch: amd64 # postgis is only available for amd64, not arm64

  monitoring:
    enabled: true

  backups:
    enabled: false
    compression: bzip2
    destination: ''
    retention: '8d'
    schedule: '0 0 0 * * *' #daily
    secretName: ''
    provider: azure # azure, s3
    s3:
      endpoint: ''
      accessKeyName: 'ACCESS_KEY'
      secretKeyName: 'SECRET_KEY'
    azure:
      connectionStringKeyName: 'CONNECTION_STRING'

  topologySpreadConstraints:

app:
  image:
    registry: docker.io
    repository: freikin/dawarich
    tag: 0.36.0
    pullPolicy: IfNotPresent
  podSecurityContext: {}

#  resources:
#    requests:
#      cpu: 10m
#      memory: 128Mi
#    limits:
#      memory: 512Mi

photon:
  enabled: true  # Controls whether to use photon at all
  deploy: true   # Controls whether to deploy internal photon instance
  config:
    country: # NL, BE, DE, FR, UK, US
    logLevel: INFO # DEBUG, INFO, ERROR
    updateStrategy: PARALLEL # PARALLEL, SEQUENTIAL, DISABLED
    updateInterval: '168h' # Has to be a time string (60s, 60h)
    md5Check: true
    forceUpdate: false
  image:
    registry: ghcr.io
    repository: rtuszik/photon-docker
    tag: 1.3.0
    pullPolicy: IfNotPresent
  podSecurityContext: {}

  persistence:
    # The geo database is over 100Gi, so we need to set this to 400Gi to allow updates of the data
    size: 400Gi
    labels: {}
#   storageClass:

#  resources:
#    requests:
#      cpu: 10m
#      memory: 128Mi
#    limits:
#      memory: 512Mi

  gateway:
    replicas: 1
    image:
      registry: docker.io
      repository: envoyproxy/envoy
      tag: v1.36.2
      pullPolicy: IfNotPresent
    podSecurityContext:
      runAsNonRoot: true
      runAsUser: 65534
      runAsGroup: 65534
      fsGroup: 65534
      seccompProfile:
        type: RuntimeDefault
    securityContext:
      allowPrivilegeEscalation: false
      capabilities:
        drop:
        - ALL
      readOnlyRootFilesystem: true
      runAsNonRoot: true
      runAsUser: 65534
      runAsGroup: 65534
      seccompProfile:
        type: RuntimeDefault
    allowedPodCidr: 10.244.0.0/16
    hosts:
      - host: photon.vanoosterhout.cloud
        rateLimit: 10
      - host: photon.komoot.io
      - host: photon.koalasec.org
      - host: photon.marsmathis.com
      - host: photon.donsomhong.net

    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        memory: 256Mi

redis:
  enabled: true
  nameOverride: redis
  # Configure redis-ha in standalone mode (single replica)
  replicas: 1
  auth: false
  redis:
    port: 6379
    config:
      # Allow writes even without replicas in standalone mode
      min-replicas-to-write: "0"
  sentinel:
    # Set quorum to 1 for single replica mode
    quorum: 1
  haproxy:
    enabled: false
  # Enable network policy to restrict access to dawarich pods only
  networkPolicy:
    enabled: true
    ingressRules:
      - selectors:
          - podSelector:
              matchLabels:
                app.kubernetes.io/component: "app"
                app.kubernetes.io/part-of: dawarich
